---
title: "State in React"
description: ""
pubDate: "Aug 8 2024"
heroImage: "/state-in-react.jpg"
---

اذا جينا نتعلم الرياكت, اهم شي بتلاحظه ان الstate هو من أهم المفاهيم بالرياكت.
كل شي بالرياكت يدور حوله. نبي نفهم وش هي الستيت, ليش هي مهمه, وكيف بنستخدمها.

##### ماهي الState؟

الستيت في الرياكت مثل الذاكرة للكمبوننت, بينما الprops تسمح لنا نمرر البيانات من الكمبوننت من برا.
الستيت هي بيانات يحتفظ به الكمبوننت داخلياً ويتحكم فيها. هالبيانات الداخلية ممكن تتغير مع الوقت وهذا يخلي الكمبوننت تفاعلي ويستجيب لأفعال المستخدم مثل الضغط على زر او غيره.

![](/state-in-react/3.webp)

##### ليش نحتاج الState؟

تخيل معي سيناريو بسيط: عندك عدّاد إشعارات بالتطبيق حقك ينقص كل ما المستخدم قرأ اشعار. او مثلاً عندك فورم والمستخدم يقدر يكتب كلام فيه, وانت تبي هالكلام هذا عشان تقدر توصله للاجزاء الثانيه بالتطبيق: مثل التو دو ليست, بهالحالات اللي زي كذا يدخل لنا مفهوم الستيت.

الستيت تسمح للكمبوننت انه يمسك البيانات هذي ويحدثه ويتفاعل معه حسب المرغوب به. بدون الستيت الكمبوننت حقك بيصير ستاتيك ومايتفاعل مع تفاعلات المستخدم مثل انه قرأ الاشعار او كتب نص داخل الفورم.

![](/state-in-react/2.webp)

##### كيف نسوي State؟

نسوي الستيت عن طريق هووك اسمه 'useState' وندير الستيت هذا عن طريقه.
هنا مثال:

![](/state-in-react/code.png)

بهالمثال, عندنا كمبوننت عدّاد. عرّفنا متغيّر الستيت ب اسم count ب قيمة بدائية 0 باستخدام useState. وبرضو نفس الuseState لازم تسوي فنكشن تحدّث الستيت setCount. كل ماضغطنا على البتن, تتحدث قيمة العدّاد, واذا تحدثت قيمة العداد ف حنا حدثنا الستيت, بهالحاله الرياكت راح تستوعب انه فيه شي تغيّر وراح تسوي re-render للكمبوننت لكن بالقيمة الجديدة.

##### كيف ندير الState؟

زي ماعرفنا فوق, اننا نستعمل فنكشن 'useState' عشان نسوي الستيت ونصير نقدر نراقب البيانات اللي تتغير مع تفاعلات المستخدم.

![](/state-in-react/ex-state.webp)

هنا عندنا امثله كثير على الستيت بموقع يودمي, حوسه صح؟

طيب شلون ندري اصلاً نحتاج كل هالستيتات؟ و وين نحطهم بالكود بالضبط؟

ادارة الستيت هي اتخاذ قرار وين نبي نحط الستيت, وش نوع الستيت اللي نحتاجه, وين نحط الستيت بالكود حقنا, و كيف تدفق البيانات راح يمشي معنا بالموقع.

وتلخيصاً لكل هذا, ادارة الستيت هي عباره عن اننا نعطي كل ستيت مكان بالكود حقنا. بالتطبيقات الصغيره نفس مثال العداد اللي فوق, الموضوع مايحتاج تعقيد نحطه بالكمبوننت اللي بنستعمله به بس. لكن كل ما كبر الموقع حقنا لازم نختار مكان الستيت المناسب لأن يمكن اكثر من كمبوننت يستعمل هالستيت!.

##### انواع الState

بالستيت عندنا نوعين, Local - Global. خاصة و عامة

![](/state-in-react/local-vs-global.webp)

بالرياكت, أي ستيت امّا انه تكون لوكل او قلوبال. اللوكل ستيت هي الستيت اللي نحتاجه فقط ب كمبوننت واحد او بعض الكمبوننتس, مثل ال child or sibling كمبوننت.
بهالحاله نسوي الستيت داخل الكمبوننت. بالمثال اللي فوق, عندنا لوكل ستيت اللي هي الinput حق البحث. هالكمبوننت هو الوحيد اللي يحتاج يعرف المدخل حق المستخدم. ف اذاً هذي لوكل.

بالنسبه للقلوبل ستيت, الستيت يقدرون يوصلون له من كل الكمبوننتس بالموقع, يسمونه Shared state. مثال على القلوبل من الصورة اللي فوق هو سلة المشتريات. هالستيت هذي نحتاجه بأكثر من كمبوننت عشان نعرف كم فيه عنصر بالسله, او نحسب السعر او نعرف وش حاط بالسلة اصلاً.

هالإختلاف هذا بين اللوكل والقلوبال نحتاجه بالمواقع والتطبيقات الكبيرة, وأحد اهم النصائح بإدارة الستيت هي انك دائماً تبدأ ب لوكل ستيت, غيره الى قلوبل ستيت اذا احتجت فقط.

##### متى نحتاج نسوي State ؟

![](/state-in-react/where-state.webp)

الموضوع يبدأ اذا استوعبت انك تبي تخزن بيانات. اول سؤال تسأله هو, هل هذي البيانات راح تتغير ب أي وقت؟ اذا كان الجواب لا, ف انت ماتحتاج ستيت, تحتاج متغيّر عادي او ثابت.

طيب اذا كانت البيانات ممكن تتغير بالمستقبل, السؤال اللي بعده هو, هل نقدر نحسب هالبيانات الجديده من ستيت موجوده او props تتمرر للكمبوننت؟. اذا كان الجواب ايه ف انت تحتاج انك تشتق الستيت اللي بتطلع البيانات منه ماتحتاج ستيت جديده. لكن بأغلب الحالات ماتقدر تشتق من الستيت.

واذا كنا مانقدر نحسب البيانات هذي, السؤال اللي بعده هو, هل اذا تحدثت هالبيانات راح تسوي re-render للكمبوننت؟. اذا كان الجواب ايه ف انت بهالحالة تحتاج تسوي ستيت جديده. ودائماً نبدأ بالستيت ك لوكل ستيت.

##### وين نحطه بالكود ؟

![](/state-in-react/where-state-2.webp)

الحين نجي لموضوع وين نحط الستيت بالكود حقنا

اذا كانت الستيت اللي بنسويها راح نستعملها بالكمبوننت اللي سويناها فيه فقط, اذاً خله بهالكمبوننت وخلصنا.

لكن بعض الاحيان, نحتاج هالستيت هذي بال child components, بهالحاله هذي نمرر الستيت عن طريق ال props بكل بساطه.

![](/state-in-react/props-state.jpg)

واذا كنا نحتاج هالستيت هذي ب sibling components او ل parent component للكمبوننت حقك, هنا لازم نغير مكان الستيت الى أول first commont parent component. بهالحاله نسمي هالمفهوم ب lifting state up.

![](/state-in-react/lifting-state.jpg)

وممكن الستيت نحتاجه بأكثر من مكان مو شرط silbling components, ممكن نحتاجه بالتطبيق كامل. بهالحاله وش نسوي؟ نخليه global state.

##### مثال توضيحي لLifting state up:

![](/state-in-react/lift-state-ex-1.jpg)

هنا عندنا parent component اسمه Checkout و تحته كمبوننت اسمه Promotions زي ماهو موضح بالمثال.

![](/state-in-react/lift-state-ex-2.jpg)

بالكمبوننت فيه ستيت اسمها coupons, ولها فنكشن تحدث الستيت اسمها setCoupons

![](/state-in-react/lift-state-ex-3.jpg)

وبرضو عندنا كمبوننت ثاني اسمه Total يحسب السعر الإجمالي, هنا نستوعب اننا نحتاج نعرف قيمة الستيت coupons عشان نحسب سعر الخصم حق الكوبون!

![](/state-in-react/lift-state-ex-4.jpg)

هنا راح نواجه مشكله, كيف نقدر نمرر الكوبون من كمبوننت promotions الى كمبوننت total؟

![](/state-in-react/lift-state-ex-5.jpg)

بالرياكت البيانات تتمرر من فوق لتحت فقط, مانقدر نمرر من تحت لفوق او من يمين ليسار. طيب كيف نحل هالمشكله؟

![](/state-in-react/lift-state-ex-6.jpg)

الحل هو اننا نسوي lifting up the state to the closest common parent, ونمرر الستيت للكمبوننت اللي تحتها عن طريق الprops. وبكذا الكمبوننتس يكون عندها وصول للكوبون ويقدرون يتعاملون معها.

##### Derived State

فوق ذكرنا موضوع الستيت المشتقّه, لكن وش هي الستيت المشتقّه وكيف نسويها ومتى نسويها؟
الستيت المشتقه: هي ستيت نقدر نحسبها من ستيت موجوده اصلاً او من الprops.

![](/state-in-react/deriving-state-ex-1.jpg)

هنا مثال, عندنا ستيت Cart سلة, وعندنا ستيت numItems تحسب كم فيه شي بالسلة, وعندنا ستيت totalPrice تحسب السعر الإجمالي للسلة.

![](/state-in-react/deriving-state-ex-2.jpg)

ستيت كم عنصر بالسلة و السعر الإجمالي اصلاً معتمده على السلة نفسه, ليه نسوي لهم ستيت؟!

![](/state-in-react/deriving-state-ex-3.jpg)

بهالحاله لازم تخليهم متزامنين مع بعض, فلازم احدث الستيتات كلها مع بعض, وبهالحاله انا بسوي 3 تحديثات للكمبوننت وبتسبب لي 3 re-render وانا ماني بحاجة 3!

![](/state-in-react/deriving-state-ex-4.jpg)

الحل الأنسب اني اشتق البيانات من الستيت واسوي الحسابات عن طريق متغيرات. numItems يحسب لي عدد عناصر الcart بكل بساطة بcart.length, والtotalPrice يجمع لي سعر العناصر الموجودات بالسلة.

![](/state-in-react/deriving-state-ex-5.jpg)

هنا موضح انه كل المتغيرين معتمده على ستيت السلة, مايحتاج نسوي ستيتات زيادة. وبيشتغل الموضوع لأن كل ماتحدثت العناصر بالسلة بتتحدث كل المتغيرات اللي مرتبطه به لأننا بنسوي re-render يعني بيستدعي الكمبوننت مره ثانيه لحاله. وبتتحدث مرة وحدة فقط مو 3 مرات نفس اللي فوق!

وبكذا لخّصت اهم المفاهيم بالستيت, وهذا مرجع لي ويارب ما انساهم.
